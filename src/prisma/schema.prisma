// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String   @id @default(uuid())
  first_name     String   @db.VarChar(255)
  last_name      String   @db.VarChar(255)
  email          String   @unique
  phone          String?  @unique
  gender         GENDER
  image          String?  @db.VarChar(255)
  email_verified Boolean  @default(false)
  phone_verified Boolean  @default(false)
  role           ROLE     @default(PATIENT)
  password       String   @db.VarChar(1000)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  patient        Patient?
  Doctor         Doctor?

  @@index([email, phone])
}

model Patient {
  id        String   @id @default(uuid())
  birthdate DateTime
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @unique
}

model Doctor {
  id                       String              @id @default(uuid())
  specialization           String              @db.VarChar(255)
  hospital_clinic_name     String              @db.VarChar(255)
  verification             VERIFICATION_STATUS @default(PENDING)
  location                 Location            @relation(fields: [locationId], references: [id])
  locationId               String              @unique
  user                     User                @relation(fields: [userId], references: [id])
  userId                   String              @unique
  appoinment_types_allowed String[]            @default(["PHYSIAL"])
  degree                   Document[]
  schedule                 Schedule[]
  charges                  Charges[]
}

model Document {
  id       String       @id @default(uuid())
  type     DOCUMENTTYPE @default(DEGREE)
  name     String       @db.VarChar(255)
  Doctor   Doctor       @relation(fields: [doctorId], references: [id])
  doctorId String       @unique

  @@index([doctorId, type], name: "doctorId_type")
}

model Location {
  id      String  @id @default(uuid())
  address String  @db.VarChar(255)
  city    String  @db.VarChar(255)
  state   String  @db.VarChar(255)
  Doctor  Doctor?
}

model Schedule {
  id                   String    @id @default(uuid())
  day                  String
  startTime            DateTime
  endTime              DateTime
  break_start          DateTime?
  break_end            DateTime?
  buffer               Int
  is_active            Boolean   @default(true)
  appointment_interval Int
  Doctor               Doctor    @relation(fields: [doctorId], references: [id])
  doctorId             String

  @@unique([doctorId, day], name: "doctorId_day")
}

model Charges {
  id               String @id @default(uuid())
  amount           Int
  appointment_type String
  Doctor           Doctor @relation(fields: [doctorId], references: [id])
  doctorId         String

  @@unique([doctorId, appointment_type], name: "doctorId_appointment_type")
}

enum GENDER {
  MALE
  FEMALE
  OTHER
}

enum ROLE {
  ADMIN
  PATIENT
  DOCTOR
}

enum DOCUMENTTYPE {
  DEGREE
  CERTFICATE
}

enum VERIFICATION_STATUS {
  PENDING
  VERIFIED
  REJECTED
}
